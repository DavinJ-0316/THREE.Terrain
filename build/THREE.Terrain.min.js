/**
 * THREE.Terrain.js 1.6.0-20210705
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license MIT
 */

!function(e){var e=e.noise={};function r(e,r,n){this.x=e,this.y=r,this.z=n}r.prototype.dot2=function(e,r){return this.x*e+this.y*r},r.prototype.dot3=function(e,r,n){return this.x*e+this.y*r+this.z*n};var t=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=new Array(512),T=new Array(512);e.seed=function(e){0<e&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var r=0;r<256;r++){var n,n=1&r?a[r]^255&e:a[r]^e>>8&255;c[r]=c[r+256]=n,T[r]=T[r+256]=t[n%12]}},e.seed(Math.random());var d=.5*(Math.sqrt(3)-1),H=(3-Math.sqrt(3))/6,n=1/3,i=1/6;function m(e){return e*e*e*(e*(6*e-15)+10)}function h(e,r,n){return(1-n)*e+n*r}e.simplex=function(e,r){var n,t,a,i=(e+r)*d,o=Math.floor(e+i),m=Math.floor(r+i),h=(o+m)*H,s=e-o+h,f=r-m+h,g,u,u=f<s?(g=1,0):(g=0,1),E=s-g+H,l=f-u+H,i=s-1+2*H,e=f-1+2*H,r=T[(o&=255)+c[m&=255]],h=T[o+g+c[m+u]],g=T[1+o+c[1+m]],u=.5-s*s-f*f,n,o=.5-E*E-l*l,t,m=.5-i*i-e*e,a;return 70*((n=u<0?0:(u*=u)*u*r.dot2(s,f))+(t=o<0?0:(o*=o)*o*h.dot2(E,l))+(a=m<0?0:(m*=m)*m*g.dot2(i,e)))},e.perlin=function(e,r){var n=Math.floor(e),t=Math.floor(r);e-=n,r-=t;var a=T[(n&=255)+c[t&=255]].dot2(e,r),i=T[n+c[1+t]].dot2(e,r-1),o=T[1+n+c[t]].dot2(e-1,r),t=T[1+n+c[1+t]].dot2(e-1,r-1),e=m(e);return h(h(a,o,e),h(i,t,e),m(r))}}(this),THREE.Terrain=function(e){var r={after:null,easing:THREE.Terrain.Linear,heightmap:THREE.Terrain.DiamondSquare,material:null,maxHeight:100,minHeight:-100,optimization:THREE.Terrain.NONE,frequency:2.5,steps:1,stretch:!0,turbulent:!1,xSegments:63,xSize:1024,ySegments:63,ySize:1024,_mesh:null},n;for(n in e=e||{},r)r.hasOwnProperty(n)&&(e[n]=(void 0===e[n]?r:e)[n]);e.material=e.material||new THREE.MeshBasicMaterial({color:15623731});var t=new THREE.Object3D;t.rotation.x=-.5*Math.PI;var a=e._mesh;if(a&&"PlaneGeometry"===a.geometry.type&&a.geometry.parameters.widthSegments===e.xSegments&&a.geometry.parameters.heightSegments===e.ySegments){a.material=e.material,a.scale.x=e.xSize/a.geometry.parameters.width,a.scale.y=e.ySize/a.geometry.parameters.height;for(var i=a.geometry.attributes.position.array,o=2,m=i.length;o<m;o+=3)i[o]=0}else a=new THREE.Mesh(new THREE.PlaneGeometry(e.xSize,e.ySize,e.xSegments,e.ySegments),e.material);return delete e._mesh,e.heightmap instanceof HTMLCanvasElement||e.heightmap instanceof Image?THREE.Terrain.fromHeightmap(a.geometry.attributes.position.array,e):"function"==typeof e.heightmap?e.heightmap(a.geometry.attributes.position.array,e):console.warn("An invalid value was passed for `options.heightmap`: "+e.heightmap),THREE.Terrain.Normalize(a,e),t.add(a),t},THREE.Terrain.Normalize=function(e,r){var n=e.geometry.attributes.position.array;r.turbulent&&THREE.Terrain.Turbulence(n,r),1<r.steps&&(THREE.Terrain.Step(n,r.steps),THREE.Terrain.Smooth(n,r)),THREE.Terrain.Clamp(n,r),"function"==typeof r.after&&r.after(n,r),e.geometry.computeBoundingSphere(),e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals()},THREE.Terrain.NONE=0,THREE.Terrain.GEOMIPMAP=1,THREE.Terrain.GEOCLIPMAP=2,THREE.Terrain.POLYGONREDUCTION=3,THREE.Terrain.toArray2D=function(e,r){for(var n=new Array(r.xSegments+1),t=r.xSegments+1,a=r.ySegments+1,i,o,i=0;i<t;i++)for(n[i]=new Float32Array(r.ySegments+1),o=0;o<a;o++)n[i][o]=e[3*(o*t+i)+2];return n},THREE.Terrain.fromArray2D=function(e,r){for(var n=0,t=r.length;n<t;n++)for(var a=0,i=r[n].length;a<i;a++)e[3*(a*t+n)+2]=r[n][a]},THREE.Terrain.toArray1D=function(e){for(var r=new Float32Array(e.length/3),n=0,t=r.length;n<t;n++)r[n]=e[3*n+2];return r},THREE.Terrain.fromArray1D=function(e,r){for(var n=0,t=Math.min(e.length/3,r.length);n<t;n++)e[3*n+2]=r[n]},THREE.Terrain.heightmapArray=function(e,r){var n=new Array((r.xSegments+1)*(r.ySegments+1)),t=n.length,a;return n.fill(0),r.minHeight=r.minHeight||0,r.maxHeight=void 0===r.maxHeight?1:r.maxHeight,r.stretch=r.stretch||!1,e(n,r),THREE.Terrain.Clamp(n,r),n},THREE.Terrain.Linear=function(e){return e},THREE.Terrain.EaseIn=function(e){return e*e},THREE.Terrain.EaseOut=function(e){return-e*(e-2)},THREE.Terrain.EaseInOut=function(e){return e*e*(3-2*e)},THREE.Terrain.InEaseOut=function(e){var e=2*e-1;return.5*e*e*e+.5},THREE.Terrain.EaseInWeak=function(e){return Math.pow(e,1.55)},THREE.Terrain.EaseInStrong=function(e){return e*e*e*e*e*e*e},THREE.Terrain.fromHeightmap=function(e,r){var n=document.createElement("canvas"),t=n.getContext("2d"),a=r.ySegments+1,i=r.xSegments+1,o=r.maxHeight-r.minHeight;n.width=i,n.height=a,t.drawImage(r.heightmap,0,0,n.width,n.height);for(var m=t.getImageData(0,0,n.width,n.height).data,h=0;h<a;h++)for(var s=0;s<i;s++){var f=h*i+s,g=4*f;e[3*f+2]=(m[g]+m[1+g]+m[2+g])/765*o+r.minHeight}},THREE.Terrain.toHeightmap=function(e,r){var n=void 0!==r.maxHeight,t=void 0!==r.minHeight,a=n?r.maxHeight:-1/0,i=t?r.minHeight:1/0;if(!n||!t){for(var o=a,m=i,h=2,s=e.length;h<s;h+=3)e[h]>o&&(o=e[h]),e[h]<m&&(m=e[h]);n||(a=o),t||(i=m)}var n=r.heightmap instanceof HTMLCanvasElement?r.heightmap:document.createElement("canvas"),t=n.getContext("2d"),f=r.ySegments+1,g=r.xSegments+1,u=a-i;n.width=g,n.height=f;for(var a=t.createImageData(n.width,n.height),E=a.data,l=0;l<f;l++)for(var c=0;c<g;c++){var T=l*g+c,d=4*T;E[d]=E[1+d]=E[2+d]=Math.round((e[3*T+2]-i)/u*255),E[3+d]=255}return t.putImageData(a,0,0),n},THREE.Terrain.Clamp=function(e,r){var n=1/0,t=-1/0,a=e.length,i;for(r.easing=r.easing||THREE.Terrain.Linear,i=0;i<a;i++)e[i].z<n&&(n=e[i].z),e[i].z>t&&(t=e[i].z);var o=t-n,m="number"!=typeof r.maxHeight?t:r.maxHeight,h="number"!=typeof r.minHeight?n:r.minHeight,s=!r.stretch&&t<m?t:m,f=!r.stretch&&h<n?n:h,g=s-f;for(s<f&&(g=(s=m)-f),i=0;i<a;i++)e[i].z=r.easing((e[i].z-n)/o)*g+h},THREE.Terrain.Edges=function(e,r,n,t,a,i){var o=Math.floor(t/(r.xSize/r.xSegments))||1,m=Math.floor(t/(r.ySize/r.ySegments))||1,h=n?r.maxHeight:r.minHeight,s=n?Math.max:Math.min,f=r.xSegments+1,g=r.ySegments+1,u,E,l,c,T;for(a=a||THREE.Terrain.EaseInOut,"object"!=typeof i&&(i={top:!0,bottom:!0,left:!0,right:!0}),u=0;u<f;u++)for(E=0;E<m;E++)l=a(1-E/m),c=E*f+u,T=(r.ySegments-E)*f+u,i.top&&(e[c].z=s(e[c].z,(h-e[c].z)*l+e[c].z)),i.bottom&&(e[T].z=s(e[T].z,(h-e[T].z)*l+e[T].z));for(u=0;u<g;u++)for(E=0;E<o;E++)l=a(1-E/o),c=u*f+E,T=(r.ySegments-u)*f+(r.xSegments-E),i.left&&(e[c].z=s(e[c].z,(h-e[c].z)*l+e[c].z)),i.right&&(e[T].z=s(e[T].z,(h-e[T].z)*l+e[T].z));THREE.Terrain.Clamp(e,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})},THREE.Terrain.RadialEdges=function(e,r,n,t,a){for(var i=n?r.maxHeight:r.minHeight,o=n?Math.max:Math.min,m=r.xSegments+1,h,s=.5*m,f=.5*(r.ySegments+1),g=r.xSize/r.xSegments,u=r.ySize/r.ySegments,E=.5*Math.min(r.xSize,r.ySize)-t,l,c,T,d,T,l=0;l<m;l++)for(c=0;c<f;c++)d=c*m+l,(T=Math.min(E,Math.sqrt((s-l)*g*(s-l)*g+(f-c)*u*(f-c)*u)-t))<0||(T=a(T/E),e[d].z=o(e[d].z,(i-e[d].z)*T+e[d].z),e[d=(r.ySegments-c)*m+l].z=o(e[d].z,(i-e[d].z)*T+e[d].z))},THREE.Terrain.Smooth=function(e,r,n){for(var t=new Float64Array(e.length),a=0,i=r.xSegments+1,o=r.ySegments+1;a<i;a++)for(var m=0;m<o;m++){for(var h=0,s=0,f=-1;f<=1;f++)for(var g=-1;g<=1;g++){var u=(m+f)*i+a+g;void 0!==e[u]&&0<=a+g&&0<=m+f&&a+g<i&&m+f<o&&(h+=e[u].z,s++)}t[m*i+a]=h/s}for(var E=1/(1+(n=n||0)),l=0,c=e.length;l<c;l++)e[l].z=(t[l]+e[l].z*n)*E},THREE.Terrain.SmoothMedian=function(e,r){for(var n=new Float64Array(e.length),t=[],a=[],i=function(e,r){return t[e]-t[r]},o=0,m=r.xSegments+1,h=r.ySegments+1;o<m;o++)for(var s=0;s<h;s++){t.length=0,a.length=0;for(var f=-1;f<=1;f++)for(var g=-1;g<=1;g++){var u=(s+f)*m+o+g;void 0!==e[u]&&0<=o+g&&0<=s+f&&o+g<m&&s+f<h&&(t.push(e[u].z),a.push(u))}a.sort(i);var E=Math.floor(.5*a.length),E,E=a.length%2==1?e[a[E]].z:.5*(e[a[E-1]].z+e[a[E]].z);n[s*m+o]=E}for(var l=0,c=e.length;l<c;l++)e[l].z=n[l]},THREE.Terrain.SmoothConservative=function(e,r,n){for(var t=new Float64Array(e.length),a=0,i=r.xSegments+1,o=r.ySegments+1;a<i;a++)for(var m=0;m<o;m++){for(var h=-1/0,s=1/0,f=-1;f<=1;f++)for(var g=-1;g<=1;g++){var u=(m+f)*i+a+g;void 0!==e[u]&&f&&g&&0<=a+g&&0<=m+f&&a+g<i&&m+f<o&&(e[u].z<s&&(s=e[u].z),e[u].z>h&&(h=e[u].z))}var E=m*i+a,l,c,h,s;"number"==typeof n&&(h=(c=s+(l=.5*(h-s)))+l*n,s=c-l*n),t[E]=e[E].z>h?h:e[E].z<s?s:e[E].z}for(var T=0,d=e.length;T<d;T++)e[T].z=t[T]},THREE.Terrain.Step=function(e,r){var n=0,t=0,a=e.length,i=Math.floor(a/r),o=new Array(a),m=new Array(r);for(void 0===r&&(r=Math.floor(Math.pow(.5*a,.25))),n=0;n<a;n++)o[n]=e[n].z;for(o.sort(function(e,r){return e-r}),n=0;n<r;n++){for(var h=o.slice(n*i,(n+1)*i),s=0,f=h.length,t=0;t<f;t++)s+=h[t];m[n]={min:h[0],max:h[h.length-1],avg:s/f}}for(n=0;n<a;n++){var g=e[n].z;for(t=0;t<r;t++)if(g>=m[t].min&&g<=m[t].max){e[n].z=m[t].avg;break}}},THREE.Terrain.Turbulence=function(e,r){for(var n=r.maxHeight-r.minHeight,t=0,a=e.length;t<a;t++)e[t].z=r.minHeight+Math.abs(2*(e[t].z-r.minHeight)-n)},THREE.Terrain.MultiPass=function(e,r,n){var t={},a;for(a in r)r.hasOwnProperty(a)&&(t[a]=r[a]);for(var i=r.maxHeight-r.minHeight,o=0,m=n.length;o<m;o++){var h,s=.5*(i-i*(void 0===n[o].amplitude?1:n[o].amplitude));t.maxHeight=r.maxHeight-s,t.minHeight=r.minHeight+s,t.frequency=(void 0===n[o].frequency?r:n[o]).frequency,n[o].method(e,t)}},THREE.Terrain.Curve=function(e,r,n){for(var t=.5*(r.maxHeight-r.minHeight),a=r.frequency/(Math.min(r.xSegments,r.ySegments)+1),i=0,o=r.xSegments+1,m=r.ySegments+1;i<o;i++)for(var h=0;h<m;h++)e[h*o+i].z+=n(i*a,h*a)*t},THREE.Terrain.Cosine=function(e,r){for(var n=.5*(r.maxHeight-r.minHeight),t=r.frequency*Math.PI/(Math.min(r.xSegments,r.ySegments)+1),a=Math.random()*Math.PI*2,i=0,o=r.xSegments+1;i<o;i++)for(var m=0,h=r.ySegments+1;m<h;m++)e[m*o+i].z+=n*(Math.cos(i*t+a)+Math.cos(m*t+a))},THREE.Terrain.CosineLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Cosine,frequency:2.5},{method:THREE.Terrain.Cosine,amplitude:.1,frequency:12},{method:THREE.Terrain.Cosine,amplitude:.05,frequency:15},{method:THREE.Terrain.Cosine,amplitude:.025,frequency:20}])},THREE.Terrain.DiamondSquare=function(e,r){for(var n=THREE.Math.ceilPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),t=n+1,a=[],i=r.maxHeight-r.minHeight,o,m,h=r.xSegments+1,s=r.ySegments+1,o=0;o<=n;o++)a[o]=new Float64Array(n+1);for(var f=n;2<=f;f/=2){var g=Math.round(.5*f),u=Math.round(f),E,l,c,T,d;for(i/=2,E=0;E<n;E+=u)for(l=0;l<n;l+=u)T=Math.random()*i*2-i,c=a[E][l]+a[E+u][l]+a[E][l+u]+a[E+u][l+u],c*=.25,a[E+g][l+g]=c+T;for(E=0;E<n;E+=g)for(l=(E+g)%f;l<n;l+=f)T=Math.random()*i*2-i,c=a[(E-g+t)%t][l]+a[(E+g)%t][l]+a[E][(l+g)%t]+a[E][(l-g+t)%t],c*=.25,c+=T,a[E][l]=c,0===E&&(a[n][l]=c),0===l&&(a[E][n]=c)}for(o=0;o<h;o++)for(m=0;m<s;m++)e[m*h+o].z+=a[o][m]},THREE.Terrain.Fault=function(e,r){for(var n=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments),t=n*r.frequency,a,i=.5*(r.maxHeight-r.minHeight)/t,o=Math.min(r.xSize/r.xSegments,r.ySize/r.ySegments)*r.frequency,m=0;m<t;m++)for(var h=Math.random(),s=Math.sin(h*Math.PI*2),f=Math.cos(h*Math.PI*2),g=Math.random()*n-.5*n,u=0,E=r.xSegments+1;u<E;u++)for(var l=0,c=r.ySegments+1;l<c;l++){var T=s*u+f*l-g;o<T?e[l*E+u].z+=i:T<-o?e[l*E+u].z-=i:e[l*E+u].z+=Math.cos(T/o*Math.PI*2)*i}},THREE.Terrain.Hill=function(e,r,n,t){var a=2*r.frequency,i=a*a*10,o=r.maxHeight-r.minHeight,m=o/(a*a),h=o/a,o=Math.min(r.xSize,r.ySize),s=o/(a*a),f=o/a;n=n||THREE.Terrain.Influences.Hill;for(var g={x:0,y:0},u=0;u<i;u++){var E=Math.random()*(f-s)+s,l=Math.random()*(h-m)+m,c=0-E,T=r.xSize+E,d=r.ySize+E;g.x=Math.random(),g.y=Math.random(),"function"==typeof t&&t(g),THREE.Terrain.Influence(e,r,n,g.x,g.y,E,l,THREE.AdditiveBlending,THREE.Terrain.EaseInStrong)}},THREE.Terrain.HillIsland=function(){var t=function(e){var r=Math.random()*Math.PI*2;e.x=.5+Math.cos(r)*e.x*.4,e.y=.5+Math.sin(r)*e.y*.4};return function(e,r,n){THREE.Terrain.Hill(e,r,n,t)}}(),function(){function g(e,r,n,t,a){for(var i=n*t+r,o=0,m;o<3;o++){switch(Math.floor(8*Math.random())){case 0:r++;break;case 1:r--;break;case 2:n++;break;case 3:n--;break;case 4:r++,n++;break;case 5:r++,n--;break;case 6:r--,n++;break;case 7:r--,n--;break}var h=n*t+r;if(void 0!==e[h]){if(e[h].z<e[i].z)return g(e,r,n,t,a),undefined}else if(Math.random()<.2)return e[i].z+=a,undefined}e[i].z+=a}THREE.Terrain.Particles=function(e,r){for(var n=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments)*r.frequency*300,t=r.xSegments+1,a=(r.maxHeight-r.minHeight)/n*1e3,i=Math.floor(Math.random()*r.xSegments),o=Math.floor(Math.random()*r.ySegments),m=.2*Math.random()-.1,h=.2*Math.random()-.1,s=0;s<n;s++){g(e,i,o,t,a);var f=Math.random()*Math.PI*2;s%1e3==0&&(m=.2*Math.random()-.1,h=.2*Math.random()-.1),s%100==0&&(i=Math.floor(r.xSegments*(.5+m)+Math.cos(f)*Math.random()*r.xSegments*(.5-Math.abs(m))),o=Math.floor(r.ySegments*(.5+h)+Math.sin(f)*Math.random()*r.ySegments*(.5-Math.abs(h))))}}}(),THREE.Terrain.Perlin=function(e,r){noise.seed(Math.random());for(var n=.5*(r.maxHeight-r.minHeight),t=(Math.min(r.xSegments,r.ySegments)+1)/r.frequency,a=0,i=r.xSegments+1;a<i;a++)for(var o=0,m=r.ySegments+1;o<m;o++)e[o*i+a].z+=noise.perlin(a/t,o/t)*n},THREE.Terrain.PerlinDiamond=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Perlin},{method:THREE.Terrain.DiamondSquare,amplitude:.75},{method:function(e,r){return THREE.Terrain.SmoothMedian(e,r)}}])},THREE.Terrain.PerlinLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Perlin,frequency:1.25},{method:THREE.Terrain.Perlin,amplitude:.05,frequency:2.5},{method:THREE.Terrain.Perlin,amplitude:.35,frequency:5},{method:THREE.Terrain.Perlin,amplitude:.15,frequency:10}])},THREE.Terrain.Simplex=function(e,r){noise.seed(Math.random());for(var n=.5*(r.maxHeight-r.minHeight),t=2*(Math.min(r.xSegments,r.ySegments)+1)/r.frequency,a=0,i=r.xSegments+1;a<i;a++)for(var o=0,m=r.ySegments+1;o<m;o++)e[o*i+a].z+=noise.simplex(a/t,o/t)*n},THREE.Terrain.SimplexLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Simplex,frequency:1.25},{method:THREE.Terrain.Simplex,amplitude:.5,frequency:2.5},{method:THREE.Terrain.Simplex,amplitude:.25,frequency:5},{method:THREE.Terrain.Simplex,amplitude:.125,frequency:10},{method:THREE.Terrain.Simplex,amplitude:.0625,frequency:20}])},function(){function o(e,r,n,t,a,i){if(!(t<n)){for(var o=0,m=0,h=t,s=t,f=Math.floor(t/n),g=-f,u=-f,o=0,E,l;o<=h;o+=f){for(m=0;m<=s;m+=f){var c=m*h+o;if(i[c]=Math.random()*a,!(g<0&&u<0)){for(var T=i[c],d=i[m*h+(o-f)]||T,H=i[(m-f)*h+o]||T,v=i[(m-f)*h+(o-f)]||T,y=g;y<o;y++)for(var M=u,x,x,S,p,R;M<m;M++){y===g&&M===u||((x=M*h+y)<0||(i[x]=(S=(M-u)/f)*((x=(y-g)/f)*T+(1-x)*d)+(1-S)*(x*H+(1-x)*v)))}u=m}}g=o,u=-f}for(o=0,h=r.xSegments+1;o<h;o++)for(m=0,s=r.ySegments+1;m<s;m++){e[m*h+o].z+=i[m*t+o]}}}THREE.Terrain.Value=function(e,r){for(var n=THREE.Math.ceilPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),t=new Float64Array((n+1)*(n+1)),a=r.maxHeight-r.minHeight,i=2;i<7;i++)o(e,r,Math.pow(2,i),n,a*Math.pow(2,2.4-1.2*i),t);THREE.Terrain.Clamp(e,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})}}(),THREE.Terrain.Weierstrass=function(e,r){for(var n=.5*(r.maxHeight-r.minHeight),t=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1,i=+Math.random()+.5,o=+Math.random()+.5,m=.025+.1*Math.random(),h=2*Math.random()-1,s=+Math.random()+.5,f=+Math.random()+.5,g=.025+.1*Math.random(),u=2*Math.random()-1,E=0,l=r.xSegments+1;E<l;E++)for(var c=0,T=r.ySegments+1;c<T;c++){for(var d=0,H=0;H<20;H++){var v=Math.pow(1+i,-H)*Math.sin(Math.pow(1+o,H)*(E+.25*Math.cos(c)+h*c)*m),y=Math.pow(1+s,-H)*Math.sin(Math.pow(1+f,H)*(c+.25*Math.cos(E)+u*E)*g);d-=Math.exp(t*v*v+a*y*y)}e[c*l+E].z+=d*n}THREE.Terrain.Clamp(e,r)},THREE.Terrain.generateBlendedMaterial=function(t){function e(e){return e===(0|e)?e+".0":e+""}for(var r="",n="",a=t[0].texture.repeat,i=t[0].texture.offset,o=0,m=t.length;o<m;o++)if(t[o].texture.wrapS=t[o].wrapT=THREE.RepeatWrapping,t[o].texture.needsUpdate=!0,r+="uniform sampler2D texture_"+o+";\n",0!==o){var h=t[o].levels,s=t[o].glsl,f=void 0!==h,g=t[o].texture.repeat,u=t[o].texture.offset;if(f){h[1]-h[0]<1&&--h[0],h[3]-h[2]<1&&(h[3]+=1);for(var E=0;E<h.length;E++)h[E]=e(h[E])}var s=f?"1.0 - smoothstep("+h[0]+", "+h[1]+", vPosition.z) + smoothstep("+h[2]+", "+h[3]+", vPosition.z)":s;n+="        color = mix( texture2D( texture_"+o+", MyvUv * vec2( "+e(g.x)+", "+e(g.y)+" ) + vec2( "+e(u.x)+", "+e(u.y)+" ) ), color, max(min("+s+", 1.0), 0.0));\n"}var l="float slope = acos(max(min(dot(myNormal, vec3(0.0, 0.0, 1.0)), 1.0), -1.0));\n    diffuseColor = vec4( diffuse, opacity );\n    vec4 color = texture2D( texture_0, MyvUv * vec2( "+e(a.x)+", "+e(a.y)+" ) + vec2( "+e(i.x)+", "+e(i.y)+" ) ); // base\n"+n+"    diffuseColor = color;\n",c=r+"\nvarying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n",i=new THREE.MeshLambertMaterial;return i.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n#include <common>"),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>","MyvUv = uv;\nvPosition = position;\nmyNormal = normal;\n#include <uv_vertex>"),e.fragmentShader=e.fragmentShader.replace("#include <common>",c+"\n#include <common>"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",l);for(var r=0,n=t.length;r<n;r++)e.uniforms["texture_"+r]={type:"t",value:t[r].texture}},i},THREE.Terrain.ScatterMeshes=function(e,r){if(!r.mesh)return console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed"),undefined;if(e instanceof THREE.BufferGeometry)return console.warn("The terrain mesh is using BufferGeometry but THREE.Terrain.ScatterMeshes can only work with Geometry."),undefined;r.scene||(r.scene=new THREE.Object3D);var n={spread:.025,smoothSpread:0,sizeVariance:.1,randomness:Math.random,maxSlope:.6283185307179586,maxTilt:1/0,w:0,h:0},t;for(t in n)n.hasOwnProperty(t)&&(r[t]=(void 0===r[t]?n:r)[t]);var a="number"==typeof r.spread,i,o,m=1/r.smoothSpread,h=2*r.sizeVariance,s=e.vertices,f=[],g=r.mesh.up.clone().applyAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI);a&&(o="number"==typeof(i=r.randomness())?Math.random:function(e){return i[e]});for(var u=0,E=2*r.w,l,c;u<E;u++)for(var T=0,d=r.h;T<d;T++){var H=T*E+u,v=e.faces[H],y=!1,M,H,y,v,x,x;a?(M=o(H))<r.spread?y=!0:M<r.spread+r.smoothSpread&&(y=THREE.Terrain.EaseInOut((M-r.spread)*m)*r.spread>Math.random()):y=r.spread(s[v.a],H,v,u,T),y&&(v.normal.angleTo(g)>r.maxSlope||((H=r.mesh.clone()).position.copy(s[v.a]).add(s[v.b]).add(s[v.c]).divideScalar(3),0<r.maxTilt&&(y=H.position.clone().add(v.normal),H.lookAt(y),(v=v.normal.angleTo(g))>r.maxTilt&&(x=r.maxTilt/v,H.rotation.x*=x,H.rotation.y*=x,H.rotation.z*=x)),H.rotation.x+=.5*Math.PI,H.rotateY(2*Math.random()*Math.PI),r.sizeVariance&&(x=Math.random()*h-r.sizeVariance,H.scale.x=H.scale.z=1+x,H.scale.y+=x),f.push(H)))}if(r.mesh.geometry instanceof THREE.Geometry){for(var S=new THREE.Geometry,l=0,c=f.length;l<c;l++){var p=f[l];p.updateMatrix(),S.merge(p.geometry,p.matrix)}r.scene.add(new THREE.Mesh(S,r.mesh.material))}else for(l=0,c=f.length;l<c;l++)r.scene.add(f[l]);return r.scene},THREE.Terrain.ScatterHelper=function(e,r,n,t){n=n||1,t=t||.25,r.frequency=r.frequency||2.5;var a={},i;for(i in r)r.hasOwnProperty(i)&&(a[i]=r[i]);a.xSegments*=2,a.stretch=!0,a.maxHeight=1,a.minHeight=0;for(var o=THREE.Terrain.heightmapArray(e,a),m=0,h=o.length;m<h;m++)(m%n||Math.random()>t)&&(o[m]=1);return function(){return o}},THREE.Terrain.Influences={Mesa:function(e){return 1.25*Math.min(.8,Math.exp(-e*e))},Hole:function(e){return-THREE.Terrain.Influences.Mesa(e)},Hill:function(e){return e<0?(e+1)*(e+1)*(3-2*(e+1)):1-e*e*(3-2*e)},Valley:function(e){return-THREE.Terrain.Influences.Hill(e)},Dome:function(e){return-(e+1)*(e-1)},Flat:function(e){return 0},Volcano:function(e){return.94-.32*(Math.abs(2*e)+Math.cos(2*Math.PI*Math.abs(e)+.4))}},THREE.Terrain.Influence=function(e,r,n,t,a,i,o,m,h){n=n||THREE.Terrain.Influences.Hill,t=void 0===t?.5:t,a=void 0===a?.5:a,i=void 0===i?64:i,o=void 0===o?64:o,m=void 0===m?THREE.NormalBlending:m,h=h||THREE.Terrain.EaseIn;for(var s=r.xSegments+1,f,g=s*t,u=(r.ySegments+1)*a,E=r.xSize/r.xSegments,l=r.ySize/r.ySegments,t=i/E,a=i/l,c=1/i,r=Math.ceil(g-t),T=Math.floor(g+t),d=Math.ceil(u-a),H=Math.floor(u+a),v=r;v<T;v++)for(var y=d;y<H;y++){var M=y*s+v,x=(v-g)*E,S=(y-u)*l,p=Math.sqrt(x*x+S*S),R=p*c,z=x*c,x=S*c,S=n(R,z,x)*o*(1-h(R,z,x));i<p||void 0===e[M]||(m===THREE.AdditiveBlending?e[M].z+=S:m===THREE.SubtractiveBlending?e[M].z-=S:m===THREE.MultiplyBlending?e[M].z*=S:m===THREE.NoBlending?e[M].z=S:m===THREE.NormalBlending?e[M].z=h(R,z,x)*e[M].z+S:"function"==typeof m&&(e[M].z=m(e[M].z,S,R,z,x)))}};
//# sourceMappingURL=THREE.Terrain.min.js.map