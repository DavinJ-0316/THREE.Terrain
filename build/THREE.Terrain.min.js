/**
 * THREE.Terrain.js 1.6.0-20210705
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license MIT
 */

!function(e){var e=e.noise={};function r(e,r,t){this.x=e,this.y=r,this.z=t}r.prototype.dot2=function(e,r){return this.x*e+this.y*r},r.prototype.dot3=function(e,r,t){return this.x*e+this.y*r+this.z*t};var n=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=new Array(512),T=new Array(512);e.seed=function(e){0<e&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var r=0;r<256;r++){var t,t=1&r?a[r]^255&e:a[r]^e>>8&255;c[r]=c[r+256]=t,T[r]=T[r+256]=n[t%12]}},e.seed(Math.random());var d=.5*(Math.sqrt(3)-1),H=(3-Math.sqrt(3))/6,t=1/3,i=1/6;function m(e){return e*e*e*(e*(6*e-15)+10)}function h(e,r,t){return(1-t)*e+t*r}e.simplex=function(e,r){var t,n,a,i=(e+r)*d,o=Math.floor(e+i),m=Math.floor(r+i),h=(o+m)*H,s=e-o+h,f=r-m+h,u,E,E=f<s?(u=1,0):(u=0,1),g=s-u+H,l=f-E+H,i=s-1+2*H,e=f-1+2*H,r=T[(o&=255)+c[m&=255]],h=T[o+u+c[m+E]],u=T[1+o+c[1+m]],E=.5-s*s-f*f,t,o=.5-g*g-l*l,n,m=.5-i*i-e*e,a;return 70*((t=E<0?0:(E*=E)*E*r.dot2(s,f))+(n=o<0?0:(o*=o)*o*h.dot2(g,l))+(a=m<0?0:(m*=m)*m*u.dot2(i,e)))},e.perlin=function(e,r){var t=Math.floor(e),n=Math.floor(r);e-=t,r-=n;var a=T[(t&=255)+c[n&=255]].dot2(e,r),i=T[t+c[1+n]].dot2(e,r-1),o=T[1+t+c[n]].dot2(e-1,r),n=T[1+t+c[1+n]].dot2(e-1,r-1),e=m(e);return h(h(a,o,e),h(i,n,e),m(r))}}(this),THREE.Terrain=function(e){var r={after:null,easing:THREE.Terrain.Linear,heightmap:THREE.Terrain.DiamondSquare,material:null,maxHeight:100,minHeight:-100,optimization:THREE.Terrain.NONE,frequency:2.5,steps:1,stretch:!0,turbulent:!1,xSegments:63,xSize:1024,ySegments:63,ySize:1024,_mesh:null},t;for(t in e=e||{},r)r.hasOwnProperty(t)&&(e[t]=(void 0===e[t]?r:e)[t]);e.material=e.material||new THREE.MeshBasicMaterial({color:15623731});var n=new THREE.Object3D;n.rotation.x=-.5*Math.PI;var a=e._mesh;if(a&&"PlaneGeometry"===a.geometry.type&&a.geometry.parameters.widthSegments===e.xSegments&&a.geometry.parameters.heightSegments===e.ySegments){a.material=e.material,a.scale.x=e.xSize/a.geometry.parameters.width,a.scale.y=e.ySize/a.geometry.parameters.height;for(var i=a.geometry.attributes.position.array,o=2,m=i.length;o<m;o+=3)i[o]=0}else a=new THREE.Mesh(new THREE.PlaneGeometry(e.xSize,e.ySize,e.xSegments,e.ySegments),e.material);delete e._mesh;var h=THREE.Terrain.toArray1D(a.geometry.attributes.position.array);return e.heightmap instanceof HTMLCanvasElement||e.heightmap instanceof Image?THREE.Terrain.fromHeightmap(h,e):"function"==typeof e.heightmap?e.heightmap(h,e):console.warn("An invalid value was passed for `options.heightmap`: "+e.heightmap),THREE.Terrain.fromArray1D(a.geometry.attributes.position.array,h),THREE.Terrain.Normalize(a,e),n.add(a),n},THREE.Terrain.Normalize=function(e,r){var t=e.geometry.attributes.position.array;r.turbulent&&THREE.Terrain.Turbulence(t,r),1<r.steps&&(THREE.Terrain.Step(t,r.steps),THREE.Terrain.Smooth(t,r)),THREE.Terrain.Clamp(t,r),"function"==typeof r.after&&r.after(t,r),e.geometry.computeBoundingSphere(),e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals()},THREE.Terrain.NONE=0,THREE.Terrain.GEOMIPMAP=1,THREE.Terrain.GEOCLIPMAP=2,THREE.Terrain.POLYGONREDUCTION=3,THREE.Terrain.toArray2D=function(e,r){for(var t=new Array(r.xSegments+1),n=r.xSegments+1,a=r.ySegments+1,i,o,i=0;i<n;i++)for(t[i]=new Float32Array(r.ySegments+1),o=0;o<a;o++)t[i][o]=e[o*n+i];return t},THREE.Terrain.fromArray2D=function(e,r){for(var t=0,n=r.length;t<n;t++)for(var a=0,i=r[t].length;a<i;a++)e[a*n+t]=r[t][a]},THREE.Terrain.toArray1D=function(e){for(var r=new Float32Array(e.length/3),t=0,n=r.length;t<n;t++)r[t]=e[3*t+2];return r},THREE.Terrain.fromArray1D=function(e,r){for(var t=0,n=Math.min(e.length/3,r.length);t<n;t++)e[3*t+2]=r[t]},THREE.Terrain.heightmapArray=function(e,r){var t=new Array((r.xSegments+1)*(r.ySegments+1)),n=t.length,a;return t.fill(0),r.minHeight=r.minHeight||0,r.maxHeight=void 0===r.maxHeight?1:r.maxHeight,r.stretch=r.stretch||!1,e(t,r),THREE.Terrain.Clamp(t,r),t},THREE.Terrain.Linear=function(e){return e},THREE.Terrain.EaseIn=function(e){return e*e},THREE.Terrain.EaseOut=function(e){return-e*(e-2)},THREE.Terrain.EaseInOut=function(e){return e*e*(3-2*e)},THREE.Terrain.InEaseOut=function(e){var e=2*e-1;return.5*e*e*e+.5},THREE.Terrain.EaseInWeak=function(e){return Math.pow(e,1.55)},THREE.Terrain.EaseInStrong=function(e){return e*e*e*e*e*e*e},THREE.Terrain.fromHeightmap=function(e,r){var t=document.createElement("canvas"),n=t.getContext("2d"),a=r.ySegments+1,i=r.xSegments+1,o=r.maxHeight-r.minHeight;t.width=i,t.height=a,n.drawImage(r.heightmap,0,0,t.width,t.height);for(var m=n.getImageData(0,0,t.width,t.height).data,h=0;h<a;h++)for(var s=0;s<i;s++){var f=h*i+s,u=4*f;e[f]=(m[u]+m[1+u]+m[2+u])/765*o+r.minHeight}},THREE.Terrain.toHeightmap=function(e,r){var t=void 0!==r.maxHeight,n=void 0!==r.minHeight,a=t?r.maxHeight:-1/0,i=n?r.minHeight:1/0;if(!t||!n){for(var o=a,m=i,h=2,s=e.length;h<s;h+=3)e[h]>o&&(o=e[h]),e[h]<m&&(m=e[h]);t||(a=o),n||(i=m)}var t=r.heightmap instanceof HTMLCanvasElement?r.heightmap:document.createElement("canvas"),n=t.getContext("2d"),f=r.ySegments+1,u=r.xSegments+1,E=a-i;t.width=u,t.height=f;for(var a=n.createImageData(t.width,t.height),g=a.data,l=0;l<f;l++)for(var c=0;c<u;c++){var T=l*u+c,d=4*T;g[d]=g[1+d]=g[2+d]=Math.round((e[3*T+2]-i)/E*255),g[3+d]=255}return n.putImageData(a,0,0),t},THREE.Terrain.Clamp=function(e,r){var t=1/0,n=-1/0,a=e.length,i;for(r.easing=r.easing||THREE.Terrain.Linear,i=0;i<a;i++)e[i]<t&&(t=e[i]),e[i]>n&&(n=e[i]);var o=n-t,m="number"!=typeof r.maxHeight?n:r.maxHeight,h="number"!=typeof r.minHeight?t:r.minHeight,s=!r.stretch&&n<m?n:m,f=!r.stretch&&h<t?t:h,u=s-f;for(s<f&&(u=(s=m)-f),i=0;i<a;i++)e[i]=r.easing((e[i]-t)/o)*u+h},THREE.Terrain.Edges=function(e,r,t,n,a,i){var o=Math.floor(n/(r.xSize/r.xSegments))||1,m=Math.floor(n/(r.ySize/r.ySegments))||1,h=t?r.maxHeight:r.minHeight,s=t?Math.max:Math.min,f=r.xSegments+1,u=r.ySegments+1,E,g,l,c,T;for(a=a||THREE.Terrain.EaseInOut,"object"!=typeof i&&(i={top:!0,bottom:!0,left:!0,right:!0}),E=0;E<f;E++)for(g=0;g<m;g++)l=a(1-g/m),c=g*f+E,T=(r.ySegments-g)*f+E,i.top&&(e[c]=s(e[c],(h-e[c])*l+e[c])),i.bottom&&(e[T]=s(e[T],(h-e[T])*l+e[T]));for(E=0;E<u;E++)for(g=0;g<o;g++)l=a(1-g/o),c=E*f+g,T=(r.ySegments-E)*f+(r.xSegments-g),i.left&&(e[c]=s(e[c],(h-e[c])*l+e[c])),i.right&&(e[T]=s(e[T],(h-e[T])*l+e[T]));THREE.Terrain.Clamp(e,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})},THREE.Terrain.RadialEdges=function(e,r,t,n,a){for(var i=t?r.maxHeight:r.minHeight,o=t?Math.max:Math.min,m=r.xSegments+1,h,s=.5*m,f=.5*(r.ySegments+1),u=r.xSize/r.xSegments,E=r.ySize/r.ySegments,g=.5*Math.min(r.xSize,r.ySize)-n,l,c,T,d,T,l=0;l<m;l++)for(c=0;c<f;c++)d=c*m+l,(T=Math.min(g,Math.sqrt((s-l)*u*(s-l)*u+(f-c)*E*(f-c)*E)-n))<0||(T=a(T/g),e[d]=o(e[d],(i-e[d])*T+e[d]),e[d=(r.ySegments-c)*m+l]=o(e[d],(i-e[d])*T+e[d]))},THREE.Terrain.Smooth=function(e,r,t){for(var n=new Float64Array(e.length),a=0,i=r.xSegments+1,o=r.ySegments+1;a<i;a++)for(var m=0;m<o;m++){for(var h=0,s=0,f=-1;f<=1;f++)for(var u=-1;u<=1;u++){var E=(m+f)*i+a+u;void 0!==e[E]&&0<=a+u&&0<=m+f&&a+u<i&&m+f<o&&(h+=e[E],s++)}n[m*i+a]=h/s}for(var g=1/(1+(t=t||0)),l=0,c=e.length;l<c;l++)e[l]=(n[l]+e[l]*t)*g},THREE.Terrain.SmoothMedian=function(e,r){for(var t=new Float64Array(e.length),n=[],a=[],i=function(e,r){return n[e]-n[r]},o=0,m=r.xSegments+1,h=r.ySegments+1;o<m;o++)for(var s=0;s<h;s++){n.length=0,a.length=0;for(var f=-1;f<=1;f++)for(var u=-1;u<=1;u++){var E=(s+f)*m+o+u;void 0!==e[E]&&0<=o+u&&0<=s+f&&o+u<m&&s+f<h&&(n.push(e[E]),a.push(E))}a.sort(i);var g=Math.floor(.5*a.length),g,g=a.length%2==1?e[a[g]]:.5*(e[a[g-1]]+e[a[g]]);t[s*m+o]=g}for(var l=0,c=e.length;l<c;l++)e[l]=t[l]},THREE.Terrain.SmoothConservative=function(e,r,t){for(var n=new Float64Array(e.length),a=0,i=r.xSegments+1,o=r.ySegments+1;a<i;a++)for(var m=0;m<o;m++){for(var h=-1/0,s=1/0,f=-1;f<=1;f++)for(var u=-1;u<=1;u++){var E=(m+f)*i+a+u;void 0!==e[E]&&f&&u&&0<=a+u&&0<=m+f&&a+u<i&&m+f<o&&(e[E]<s&&(s=e[E]),e[E]>h&&(h=e[E]))}var g=m*i+a,l,c,h,s;"number"==typeof t&&(h=(c=s+(l=.5*(h-s)))+l*t,s=c-l*t),n[g]=e[g]>h?h:e[g]<s?s:e[g]}for(var T=0,d=e.length;T<d;T++)e[T]=n[T]},THREE.Terrain.Step=function(e,r){var t=0,n=0,a=e.length,i=Math.floor(a/r),o=new Array(a),m=new Array(r);for(void 0===r&&(r=Math.floor(Math.pow(.5*a,.25))),t=0;t<a;t++)o[t]=e[t];for(o.sort(function(e,r){return e-r}),t=0;t<r;t++){for(var h=o.slice(t*i,(t+1)*i),s=0,f=h.length,n=0;n<f;n++)s+=h[n];m[t]={min:h[0],max:h[h.length-1],avg:s/f}}for(t=0;t<a;t++){var u=e[t];for(n=0;n<r;n++)if(u>=m[n].min&&u<=m[n].max){e[t]=m[n].avg;break}}},THREE.Terrain.Turbulence=function(e,r){for(var t=r.maxHeight-r.minHeight,n=0,a=e.length;n<a;n++)e[n]=r.minHeight+Math.abs(2*(e[n]-r.minHeight)-t)},THREE.Terrain.MultiPass=function(e,r,t){var n={},a;for(a in r)r.hasOwnProperty(a)&&(n[a]=r[a]);for(var i=r.maxHeight-r.minHeight,o=0,m=t.length;o<m;o++){var h,s=.5*(i-i*(void 0===t[o].amplitude?1:t[o].amplitude));n.maxHeight=r.maxHeight-s,n.minHeight=r.minHeight+s,n.frequency=(void 0===t[o].frequency?r:t[o]).frequency,t[o].method(e,n)}},THREE.Terrain.Curve=function(e,r,t){for(var n=.5*(r.maxHeight-r.minHeight),a=r.frequency/(Math.min(r.xSegments,r.ySegments)+1),i=0,o=r.xSegments+1,m=r.ySegments+1;i<o;i++)for(var h=0;h<m;h++)e[h*o+i]+=t(i*a,h*a)*n},THREE.Terrain.Cosine=function(e,r){for(var t=.5*(r.maxHeight-r.minHeight),n=r.frequency*Math.PI/(Math.min(r.xSegments,r.ySegments)+1),a=Math.random()*Math.PI*2,i=0,o=r.xSegments+1;i<o;i++)for(var m=0,h=r.ySegments+1;m<h;m++)e[m*o+i]+=t*(Math.cos(i*n+a)+Math.cos(m*n+a))},THREE.Terrain.CosineLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Cosine,frequency:2.5},{method:THREE.Terrain.Cosine,amplitude:.1,frequency:12},{method:THREE.Terrain.Cosine,amplitude:.05,frequency:15},{method:THREE.Terrain.Cosine,amplitude:.025,frequency:20}])},THREE.Terrain.DiamondSquare=function(e,r){for(var t=THREE.Math.ceilPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),n=t+1,a=[],i=r.maxHeight-r.minHeight,o,m,h=r.xSegments+1,s=r.ySegments+1,o=0;o<=t;o++)a[o]=new Float64Array(t+1);for(var f=t;2<=f;f/=2){var u=Math.round(.5*f),E=Math.round(f),g,l,c,T,d;for(i/=2,g=0;g<t;g+=E)for(l=0;l<t;l+=E)T=Math.random()*i*2-i,c=a[g][l]+a[g+E][l]+a[g][l+E]+a[g+E][l+E],c*=.25,a[g+u][l+u]=c+T;for(g=0;g<t;g+=u)for(l=(g+u)%f;l<t;l+=f)T=Math.random()*i*2-i,c=a[(g-u+n)%n][l]+a[(g+u)%n][l]+a[g][(l+u)%n]+a[g][(l-u+n)%n],c*=.25,c+=T,a[g][l]=c,0===g&&(a[t][l]=c),0===l&&(a[g][t]=c)}for(o=0;o<h;o++)for(m=0;m<s;m++)e[m*h+o]+=a[o][m]},THREE.Terrain.Fault=function(e,r){for(var t=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments),n=t*r.frequency,a,i=.5*(r.maxHeight-r.minHeight)/n,o=Math.min(r.xSize/r.xSegments,r.ySize/r.ySegments)*r.frequency,m=0;m<n;m++)for(var h=Math.random(),s=Math.sin(h*Math.PI*2),f=Math.cos(h*Math.PI*2),u=Math.random()*t-.5*t,E=0,g=r.xSegments+1;E<g;E++)for(var l=0,c=r.ySegments+1;l<c;l++){var T=s*E+f*l-u;o<T?e[l*g+E]+=i:T<-o?e[l*g+E]-=i:e[l*g+E]+=Math.cos(T/o*Math.PI*2)*i}},THREE.Terrain.Hill=function(e,r,t,n){var a=2*r.frequency,i=a*a*10,o=r.maxHeight-r.minHeight,m=o/(a*a),h=o/a,o=Math.min(r.xSize,r.ySize),s=o/(a*a),f=o/a;t=t||THREE.Terrain.Influences.Hill;for(var u={x:0,y:0},E=0;E<i;E++){var g=Math.random()*(f-s)+s,l=Math.random()*(h-m)+m,c=0-g,T=r.xSize+g,d=r.ySize+g;u.x=Math.random(),u.y=Math.random(),"function"==typeof n&&n(u),THREE.Terrain.Influence(e,r,t,u.x,u.y,g,l,THREE.AdditiveBlending,THREE.Terrain.EaseInStrong)}},THREE.Terrain.HillIsland=function(){var n=function(e){var r=Math.random()*Math.PI*2;e.x=.5+Math.cos(r)*e.x*.4,e.y=.5+Math.sin(r)*e.y*.4};return function(e,r,t){THREE.Terrain.Hill(e,r,t,n)}}(),function(){function u(e,r,t,n,a){for(var i=t*n+r,o=0,m;o<3;o++){switch(Math.floor(8*Math.random())){case 0:r++;break;case 1:r--;break;case 2:t++;break;case 3:t--;break;case 4:r++,t++;break;case 5:r++,t--;break;case 6:r--,t++;break;case 7:r--,t--;break}var h=t*n+r;if(void 0!==e[h]){if(e[h]<e[i])return u(e,r,t,n,a),undefined}else if(Math.random()<.2)return e[i]+=a,undefined}e[i]+=a}THREE.Terrain.Particles=function(e,r){for(var t=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments)*r.frequency*300,n=r.xSegments+1,a=(r.maxHeight-r.minHeight)/t*1e3,i=Math.floor(Math.random()*r.xSegments),o=Math.floor(Math.random()*r.ySegments),m=.2*Math.random()-.1,h=.2*Math.random()-.1,s=0;s<t;s++){u(e,i,o,n,a);var f=Math.random()*Math.PI*2;s%1e3==0&&(m=.2*Math.random()-.1,h=.2*Math.random()-.1),s%100==0&&(i=Math.floor(r.xSegments*(.5+m)+Math.cos(f)*Math.random()*r.xSegments*(.5-Math.abs(m))),o=Math.floor(r.ySegments*(.5+h)+Math.sin(f)*Math.random()*r.ySegments*(.5-Math.abs(h))))}}}(),THREE.Terrain.Perlin=function(e,r){noise.seed(Math.random());for(var t=.5*(r.maxHeight-r.minHeight),n=(Math.min(r.xSegments,r.ySegments)+1)/r.frequency,a=0,i=r.xSegments+1;a<i;a++)for(var o=0,m=r.ySegments+1;o<m;o++)e[o*i+a]+=noise.perlin(a/n,o/n)*t},THREE.Terrain.PerlinDiamond=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Perlin},{method:THREE.Terrain.DiamondSquare,amplitude:.75},{method:function(e,r){return THREE.Terrain.SmoothMedian(e,r)}}])},THREE.Terrain.PerlinLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Perlin,frequency:1.25},{method:THREE.Terrain.Perlin,amplitude:.05,frequency:2.5},{method:THREE.Terrain.Perlin,amplitude:.35,frequency:5},{method:THREE.Terrain.Perlin,amplitude:.15,frequency:10}])},THREE.Terrain.Simplex=function(e,r){noise.seed(Math.random());for(var t=.5*(r.maxHeight-r.minHeight),n=2*(Math.min(r.xSegments,r.ySegments)+1)/r.frequency,a=0,i=r.xSegments+1;a<i;a++)for(var o=0,m=r.ySegments+1;o<m;o++)e[o*i+a]+=noise.simplex(a/n,o/n)*t},THREE.Terrain.SimplexLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Simplex,frequency:1.25},{method:THREE.Terrain.Simplex,amplitude:.5,frequency:2.5},{method:THREE.Terrain.Simplex,amplitude:.25,frequency:5},{method:THREE.Terrain.Simplex,amplitude:.125,frequency:10},{method:THREE.Terrain.Simplex,amplitude:.0625,frequency:20}])},function(){function o(e,r,t,n,a,i){if(!(n<t)){for(var o=0,m=0,h=n,s=n,f=Math.floor(n/t),u=-f,E=-f,o=0,g,l;o<=h;o+=f){for(m=0;m<=s;m+=f){var c=m*h+o;if(i[c]=Math.random()*a,!(u<0&&E<0)){for(var T=i[c],d=i[m*h+(o-f)]||T,H=i[(m-f)*h+o]||T,v=i[(m-f)*h+(o-f)]||T,y=u;y<o;y++)for(var M=E,x,x,p,S,R;M<m;M++){y===u&&M===E||((x=M*h+y)<0||(i[x]=(p=(M-E)/f)*((x=(y-u)/f)*T+(1-x)*d)+(1-p)*(x*H+(1-x)*v)))}E=m}}u=o,E=-f}for(o=0,h=r.xSegments+1;o<h;o++)for(m=0,s=r.ySegments+1;m<s;m++){e[m*h+o]+=i[m*n+o]}}}THREE.Terrain.Value=function(e,r){for(var t=THREE.Math.ceilPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),n=new Float64Array((t+1)*(t+1)),a=r.maxHeight-r.minHeight,i=2;i<7;i++)o(e,r,Math.pow(2,i),t,a*Math.pow(2,2.4-1.2*i),n);THREE.Terrain.Clamp(e,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})}}(),THREE.Terrain.Weierstrass=function(e,r){for(var t=.5*(r.maxHeight-r.minHeight),n=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1,i=+Math.random()+.5,o=+Math.random()+.5,m=.025+.1*Math.random(),h=2*Math.random()-1,s=+Math.random()+.5,f=+Math.random()+.5,u=.025+.1*Math.random(),E=2*Math.random()-1,g=0,l=r.xSegments+1;g<l;g++)for(var c=0,T=r.ySegments+1;c<T;c++){for(var d=0,H=0;H<20;H++){var v=Math.pow(1+i,-H)*Math.sin(Math.pow(1+o,H)*(g+.25*Math.cos(c)+h*c)*m),y=Math.pow(1+s,-H)*Math.sin(Math.pow(1+f,H)*(c+.25*Math.cos(g)+E*g)*u);d-=Math.exp(n*v*v+a*y*y)}e[c*l+g]+=d*t}THREE.Terrain.Clamp(e,r)},THREE.Terrain.generateBlendedMaterial=function(n){function e(e){return e===(0|e)?e+".0":e+""}for(var r="",t="",a=n[0].texture.repeat,i=n[0].texture.offset,o=0,m=n.length;o<m;o++)if(n[o].texture.wrapS=n[o].wrapT=THREE.RepeatWrapping,n[o].texture.needsUpdate=!0,r+="uniform sampler2D texture_"+o+";\n",0!==o){var h=n[o].levels,s=n[o].glsl,f=void 0!==h,u=n[o].texture.repeat,E=n[o].texture.offset;if(f){h[1]-h[0]<1&&--h[0],h[3]-h[2]<1&&(h[3]+=1);for(var g=0;g<h.length;g++)h[g]=e(h[g])}var s=f?"1.0 - smoothstep("+h[0]+", "+h[1]+", vPosition.z) + smoothstep("+h[2]+", "+h[3]+", vPosition.z)":s;t+="        color = mix( texture2D( texture_"+o+", MyvUv * vec2( "+e(u.x)+", "+e(u.y)+" ) + vec2( "+e(E.x)+", "+e(E.y)+" ) ), color, max(min("+s+", 1.0), 0.0));\n"}var l="float slope = acos(max(min(dot(myNormal, vec3(0.0, 0.0, 1.0)), 1.0), -1.0));\n    diffuseColor = vec4( diffuse, opacity );\n    vec4 color = texture2D( texture_0, MyvUv * vec2( "+e(a.x)+", "+e(a.y)+" ) + vec2( "+e(i.x)+", "+e(i.y)+" ) ); // base\n"+t+"    diffuseColor = color;\n",c=r+"\nvarying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n",i=new THREE.MeshLambertMaterial;return i.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n#include <common>"),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>","MyvUv = uv;\nvPosition = position;\nmyNormal = normal;\n#include <uv_vertex>"),e.fragmentShader=e.fragmentShader.replace("#include <common>",c+"\n#include <common>"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",l);for(var r=0,t=n.length;r<t;r++)e.uniforms["texture_"+r]={type:"t",value:n[r].texture}},i},THREE.Terrain.ScatterMeshes=function(e,r){if(!r.mesh)return console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed"),undefined;r.scene||(r.scene=new THREE.Object3D);var t={spread:.025,smoothSpread:0,sizeVariance:.1,randomness:Math.random,maxSlope:.6283185307179586,maxTilt:1/0,w:0,h:0},n;for(n in t)t.hasOwnProperty(n)&&(r[n]=(void 0===r[n]?t:r)[n]);var a="number"==typeof r.spread,i,o,m=1/r.smoothSpread,h=2*r.sizeVariance,s=new THREE.Vector3,u=new THREE.Vector3,E=new THREE.Vector3,g=new THREE.Vector3,l=e.vertices,c=[],T=r.mesh.up.clone().applyAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI);a&&(o="number"==typeof(i=r.randomness())?Math.random:function(e){return i[e]});for(var d=0,H=2*r.w;d<H;d++)for(var v=0,y=r.h;v<y;v++){var M=v*H+d,x=!1,p=e.index.array[3*M+0],S=e.index.array[3*M+1],R=e.index.array[3*M+2],w=e.attributes.position.array.slice(p,p+3),b=e.attributes.position.array.slice(S,S+3),P=e.attributes.position.array.slice(R,R+3),R,x,P,P,q,q;s.fromBufferAttribute(e.attributes.normal,p),u.fromBufferAttribute(e.attributes.normal,S),E.fromBufferAttribute(e.attributes.normal,R),g.copy(s).add(u).add(E).divideScalar(3),a?(R=o(M))<r.spread?x=!0:R<r.spread+r.smoothSpread&&(x=THREE.Terrain.EaseInOut((R-r.spread)*m)*r.spread>Math.random()):x=r.spread(new THREE.Vector3(w[0],w[1],w[2]),M,f,d,v),x&&(g.angleTo(T)>r.maxSlope||((x=r.mesh.clone()).position.set((w[0]+b[0]+P[0])/3,(w[1]+b[1]+P[1])/3,(w[2]+b[2]+P[2])/3),0<r.maxTilt&&(P=x.position.clone().add(g),x.lookAt(P),(P=g.angleTo(T))>r.maxTilt&&(q=r.maxTilt/P,x.rotation.x*=q,x.rotation.y*=q,x.rotation.z*=q)),x.rotation.x+=.5*Math.PI,x.rotateY(2*Math.random()*Math.PI),r.sizeVariance&&(q=Math.random()*h-r.sizeVariance,x.scale.x=x.scale.z=1+q,x.scale.y+=q),c.push(x)))}for(var I=new THREE.BufferGeometry,z=0,A=c.length;z<A;z++){var C=c[z];C.updateMatrix(),I.merge(C.geometry,C.matrix)}return r.scene.add(new THREE.Mesh(I,r.mesh.material)),r.scene},THREE.Terrain.ScatterHelper=function(e,r,t,n){t=t||1,n=n||.25,r.frequency=r.frequency||2.5;var a={},i;for(i in r)r.hasOwnProperty(i)&&(a[i]=r[i]);a.xSegments*=2,a.stretch=!0,a.maxHeight=1,a.minHeight=0;for(var o=THREE.Terrain.heightmapArray(e,a),m=0,h=o.length;m<h;m++)(m%t||Math.random()>n)&&(o[m]=1);return function(){return o}},THREE.Terrain.Influences={Mesa:function(e){return 1.25*Math.min(.8,Math.exp(-e*e))},Hole:function(e){return-THREE.Terrain.Influences.Mesa(e)},Hill:function(e){return e<0?(e+1)*(e+1)*(3-2*(e+1)):1-e*e*(3-2*e)},Valley:function(e){return-THREE.Terrain.Influences.Hill(e)},Dome:function(e){return-(e+1)*(e-1)},Flat:function(e){return 0},Volcano:function(e){return.94-.32*(Math.abs(2*e)+Math.cos(2*Math.PI*Math.abs(e)+.4))}},THREE.Terrain.Influence=function(e,r,t,n,a,i,o,m,h){t=t||THREE.Terrain.Influences.Hill,n=void 0===n?.5:n,a=void 0===a?.5:a,i=void 0===i?64:i,o=void 0===o?64:o,m=void 0===m?THREE.NormalBlending:m,h=h||THREE.Terrain.EaseIn;for(var s=r.xSegments+1,f,u=s*n,E=(r.ySegments+1)*a,g=r.xSize/r.xSegments,l=r.ySize/r.ySegments,n=i/g,a=i/l,c=1/i,r=Math.ceil(u-n),T=Math.floor(u+n),d=Math.ceil(E-a),H=Math.floor(E+a),v=r;v<T;v++)for(var y=d;y<H;y++){var M=y*s+v,x=(v-u)*g,p=(y-E)*l,S=Math.sqrt(x*x+p*p),R=S*c,w=x*c,x=p*c,p=t(R,w,x)*o*(1-h(R,w,x));i<S||void 0===e[M]||(m===THREE.AdditiveBlending?e[M]+=p:m===THREE.SubtractiveBlending?e[M]-=p:m===THREE.MultiplyBlending?e[M]*=p:m===THREE.NoBlending?e[M]=p:m===THREE.NormalBlending?e[M]=h(R,w,x)*e[M]+p:"function"==typeof m&&(e[M]=m(e[M].z,p,R,w,x)))}};
//# sourceMappingURL=THREE.Terrain.min.js.map